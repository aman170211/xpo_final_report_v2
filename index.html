<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Scraped XPO Invoice Entries</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; padding: 30px; }
    h2 { margin-bottom: 20px; }
    .filter-section { margin-bottom: 20px; }
    .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab-buttons button {
      padding: 10px 20px;
      border: none;
      background: #d6dff6;
      color: #1c3f93;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .tab-buttons button.active { background: #1c3f93; color: white; }
    .tab-section { display: none; }
    .tab-section.active { display: block; }
    .record {
      border: 1px solid #ccc;
      margin-bottom: 15px;
      border-radius: 8px;
      background: white;
      padding: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
<h2>ğŸ“‹ Scraped XPO Invoice Entries</h2>

<div class="filter-section">
  <label for="createdDate">Created Date:</label>
  <input type="date" id="createdDate" />
</div>

<div class="tab-buttons">
  <button id="tab-unreviewed" class="active">ğŸ“‚ Unreviewed</button>
  <button id="tab-reviewed">âœ… Reviewed</button>
  <button id="tab-manual-review">âš ï¸ Manual Review</button>
  <button id="tab-balance-due">ğŸ’° Balance Due</button>
</div>

<div id="unreviewed" class="tab-section active"></div>
<div id="reviewed" class="tab-section"></div>
<div id="manual-review" class="tab-section"></div>
<div id="balance-due" class="tab-section"></div>

<script>
function renderSection(sectionId, records) {
  const container = document.getElementById(sectionId);
  container.innerHTML = '';
  records.forEach((record, idx) => {
    const div = document.createElement('div');
    div.className = 'record';
    div.innerHTML = `
      <strong>${idx + 1}. ${record.File_Name || 'No Name'}</strong><br/>
      <div>ğŸ†” <b>Pro #:</b> ${record.Pro_Number || 'â€”'}</div>
      <div>ğŸ“¦ <b>BOL:</b> ${record.BOL_BOL || 'â€”'}</div>
      <div>ğŸ“… <b>Date:</b> ${record.Created_Date || 'â€”'}</div>
      <div>ğŸšš <b>Shipper:</b> ${record.Shipper_Name || 'â€”'}</div>
      <div>ğŸ  <b>Consignee:</b> ${record.Consignee_Name || 'â€”'}</div>
    `;
    container.appendChild(div);
  });
}

function classifyAndRender(data) {
  renderSection('unreviewed', data.filter(r =>
    r.Reviewed === "false" &&
    r.Manual_Review_Needed === "false" &&
    r.Balance_Due_checkbox === "false"
  ));
  renderSection('reviewed', data.filter(r => r.Reviewed === "true"));
  renderSection('manual-review', data.filter(r => r.Manual_Review_Needed === "true"));
  renderSection('balance-due', data.filter(r => r.Balance_Due_checkbox === "true"));
}

function setActiveTab(tabName) {
  const allTabs = ["unreviewed", "reviewed", "manual-review", "balance-due"];
  allTabs.forEach(name => {
    document.getElementById(name).classList.remove("active");
    document.getElementById(`tab-${name}`).classList.remove("active");
  });
  document.getElementById(tabName).classList.add("active");
  document.getElementById(`tab-${tabName}`).classList.add("active");
}

async function fetchDataForDate(dateStr) {
  const formattedDate = formatDateToZoho(dateStr);
  const apiUrl = `https://ew0nbf06x1.execute-api.us-east-2.amazonaws.com/XPO_final_Data_fetch?Created_Date=${encodeURIComponent(formattedDate)}`;
  try {
    const res = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    });
    const data = await res.json();
    classifyAndRender(data.data || []);
  } catch (err) {
    console.warn('âŒ Failed to fetch data:', err);
    classifyAndRender([]);
  }
}

function formatDateToZoho(dateStr) {
  const [yyyy, mm, dd] = dateStr.split("-");
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  return `${dd}-${months[parseInt(mm) - 1]}-${yyyy}`;
}

document.getElementById("tab-unreviewed").addEventListener("click", () => setActiveTab("unreviewed"));
document.getElementById("tab-reviewed").addEventListener("click", () => setActiveTab("reviewed"));
document.getElementById("tab-manual-review").addEventListener("click", () => setActiveTab("manual-review"));
document.getElementById("tab-balance-due").addEventListener("click", () => setActiveTab("balance-due"));

document.getElementById("createdDate").addEventListener("change", (e) => {
  fetchDataForDate(e.target.value);
});

window.onload = () => {
  const input = document.getElementById("createdDate");
  const today = new Date().toISOString().split("T")[0];
  input.value = today;
  fetchDataForDate(today);
};
</script>
</body>
</html>
