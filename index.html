<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Scraped XPO Invoice Entries 2</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; padding: 30px; }
    h2 { margin-bottom: 20px; }
    .filter-section { margin-bottom: 20px; }
    .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab-buttons button {
      padding: 10px 20px;
      border: none;
      background: #d6dff6;
      color: #1c3f93;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }
    .tab-buttons button.active { background: #1c3f93; color: white; }
    .tab-section { display: none; }
    .tab-section.active { display: block; }
    .no-records {
      padding: 20px;
      color: #666;
      font-style: italic;
    }

    .record-tile {
      border: 1px solid #ccc;
      border-left: 6px solid #1c3f93;
      border-radius: 8px;
      margin-bottom: 15px;
      background: #fff;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }

    .record-header {
      background: #1c3f93;
      color: white;
      padding: 12px 16px;
      font-weight: bold;
      cursor: pointer;
    }

    .record-details {
      display: none;
      padding: 12px 16px;
      background: #f9f9f9;
    }

    .record-details table {
      width: 100%;
      border-collapse: collapse;
    }

    .record-details th, .record-details td {
      text-align: left;
      padding: 6px 10px;
      border-bottom: 1px solid #ddd;
    }

    .record-details th {
      background: #f0f0f0;
      font-weight: 600;
      width: 200px;
    }
  </style>
</head>
<body>
<h2>üìã Scraped XPO Invoice Entries</h2>

<div class="filter-section">
  <label for="createdDate">Created Date:</label>
  <input type="date" id="createdDate" />
</div>

<div class="tab-buttons">
  <button id="tab-unreviewed" class="active">üìÇ Unreviewed</button>
  <button id="tab-reviewed">‚úÖ Reviewed</button>
  <button id="tab-manual-review">‚ö†Ô∏è Manual Review</button>
  <button id="tab-balance-due">üí∞ Balance Due</button>
</div>

<div id="unreviewed" class="tab-section active"></div>
<div id="reviewed" class="tab-section"></div>
<div id="manual-review" class="tab-section"></div>
<div id="balance-due" class="tab-section"></div>

<script>
function renderSection(sectionId, records) {
  const container = document.getElementById(sectionId);
  container.innerHTML = '';

  const sectionNames = {
    "unreviewed": "Unreviewed",
    "reviewed": "Reviewed",
    "manual-review": "Manual Review",
    "balance-due": "Balance Due"
  };

  if (records.length === 0) {
    const inputDate = document.getElementById("createdDate").value;
    const msg = document.createElement("div");
    msg.className = "no-records";
    msg.textContent = `No records in ${sectionNames[sectionId]} on ${inputDate}`;
    container.appendChild(msg);
    return;
  }

  records.forEach((record, idx) => {
    const tile = document.createElement('div');
    tile.className = 'record-tile';

    const header = document.createElement('div');
    header.className = 'record-header';
    header.innerHTML = `<strong>${idx + 1}. ${record.File_Name || 'No Name'}</strong> ‚Äî ${record.Created_Date || 'Unknown Date'}`;
    header.onclick = () => {
      detail.style.display = detail.style.display === 'block' ? 'none' : 'block';
    };

    const detail = document.createElement('div');
    detail.className = 'record-details';
    detail.innerHTML = `
      <table>
        <tr><th>Pro Number</th><td>${record.Pro_Number || '‚Äî'}</td></tr>
        <tr><th>BOL Number</th><td>${record.BOL_BOL || '‚Äî'}</td></tr>
        <tr><th>Shipper</th><td>${record.Shipper_Name || '‚Äî'}</td></tr>
        <tr><th>Consignee</th><td>${record.Consignee_Name || '‚Äî'}</td></tr>
        <tr><th>Weight</th><td>${record.Total_Weight_BOL || '‚Äî'}</td></tr>
        <tr><th>Freight Charge</th><td>${record.Freight_Charge_Invoice || '‚Äî'}</td></tr>
        <tr><th>Fuel Surcharge</th><td>${record.Fuel_Surcharge_Invoice || '‚Äî'}</td></tr>
        <tr><th>Discount Amount</th><td>${record.Discount_Amount_Invoice || '‚Äî'}</td></tr>
        <tr><th>Subtotal</th><td>${record.SubTotal || '‚Äî'}</td></tr>
        <tr><th>Accessorials</th><td>${record.Accessorials_Invoice || '‚Äî'}</td></tr>
        <tr><th>Order No / PO</th><td>${record.Customer_PO_BOL || '‚Äî'}</td></tr>
      </table>
    `;

    tile.appendChild(header);
    tile.appendChild(detail);
    container.appendChild(tile);
  });
}

function classifyAndRender(data) {
  renderSection('unreviewed', data.filter(r =>
    r.Reviewed === "false" &&
    r.Manual_Review_Needed === "false" &&
    r.Balance_Due_checkbox === "false"
  ));
  renderSection('reviewed', data.filter(r => r.Reviewed === "true"));
  renderSection('manual-review', data.filter(r => r.Manual_Review_Needed === "true"));
  renderSection('balance-due', data.filter(r => r.Balance_Due_checkbox === "true"));
}

function setActiveTab(tabName) {
  const allTabs = ["unreviewed", "reviewed", "manual-review", "balance-due"];
  allTabs.forEach(name => {
    document.getElementById(name).classList.remove("active");
    document.getElementById(`tab-${name}`).classList.remove("active");
  });
  document.getElementById(tabName).classList.add("active");
  document.getElementById(`tab-${tabName}`).classList.add("active");
}

async function fetchDataForDate(dateStr) {
  const formattedDate = formatDateToZoho(dateStr);
  const apiUrl = `https://ew0nbf06x1.execute-api.us-east-2.amazonaws.com/XPO_final_Data_fetch?Created_Date=${encodeURIComponent(formattedDate)}`;
  try {
    const res = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    });
    const data = await res.json();
    classifyAndRender(data.data || []);
  } catch (err) {
    console.warn('‚ùå Failed to fetch data:', err);
    classifyAndRender([]);
  }
}

function formatDateToZoho(dateStr) {
  const [yyyy, mm, dd] = dateStr.split("-");
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  return `${dd}-${months[parseInt(mm) - 1]}-${yyyy}`;
}

document.getElementById("tab-unreviewed").addEventListener("click", () => setActiveTab("unreviewed"));
document.getElementById("tab-reviewed").addEventListener("click", () => setActiveTab("reviewed"));
document.getElementById("tab-manual-review").addEventListener("click", () => setActiveTab("manual-review"));
document.getElementById("tab-balance-due").addEventListener("click", () => setActiveTab("balance-due"));

document.getElementById("createdDate").addEventListener("change", (e) => {
  fetchDataForDate(e.target.value);
});

window.onload = () => {
  const input = document.getElementById("createdDate");
  const today = new Date().toISOString().split("T")[0];
  input.value = today;
  fetchDataForDate(today);
};
</script>
</body>
</html>
